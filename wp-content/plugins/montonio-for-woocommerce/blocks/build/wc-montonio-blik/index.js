(()=>{"use strict";const e=window.React,o=window.wp.element,t=window.wp.data,n=window.wp.i18n,{registerPaymentMethod:r}=wc.wcBlocksRegistry,{getSetting:c}=wc.wcSettings,{decodeEntities:i}=wp.htmlEntities,{applyFilters:a,addFilter:s}=wp.hooks,l=c("wc_montonio_blik_data",{}),m=a("wc_montonio_blik_block_title",i(l.title||(0,n.__)("BLIK","montonio-for-woocommerce")),l);s("wc_montonio_blik_block_description","montonio-for-woocommerce",((e,o)=>("yes"===o.sandboxMode&&(e="<strong>"+(0,n.__)("TEST MODE ENABLED!","montonio-for-woocommerce")+"</strong><br>"+(0,n.__)("When test mode is enabled, payment providers do not process payments.","montonio-for-woocommerce")+"<br>"+e),e)));const d=a("wc_montonio_blik_block_description",i(l.description),l),u=t=>(0,e.createElement)(o.RawHTML,null,t),w=({setEmbeddedPayment:t})=>{const[r,c]=(0,o.useState)(!1),[i,a]=(0,o.useState)(null);return(0,o.useEffect)((()=>{const e=document.getElementById("montonio-blik-form");e&&!e.hasChildNodes()&&(async()=>{c(!0),a(null);try{if("undefined"==typeof Montonio||void 0===Montonio.Checkout)throw new Error("Montonio SDK is not loaded");const e=document.getElementById("montonio-blik-form");if(!e)throw new Error("Target element not found");const o=new Montonio.Checkout.Blik({locale:l.locale||"en",environment:"yes"===l.sandboxMode?"sandbox":"production",targetElement:e});await o.render(),t(o)}catch(e){console.error("Error in initializePayment:",e),a(e.message||"Failed to initialize payment form")}finally{c(!1)}})()}),[]),(0,e.createElement)("div",{id:"montonio-blik-form-wrapper",className:r?"loading":"",style:r?{opacity:.6}:{}},r&&(0,e.createElement)("div",{className:"montonio-loader"},(0,n.__)("Loading...","montonio-for-woocommerce")),i&&(0,e.createElement)("div",{className:"montonio-error"},i),(0,e.createElement)("div",{id:"montonio-blik-form"}))},p=({eventRegistration:r})=>{if("yes"!==l.inlineCheckout)return d?(0,e.createElement)("p",{className:"montonio-payment-block-description"},u(d)):null;const{onPaymentSetup:c,onCheckoutSuccess:i,onCheckoutFail:a}=r,[s,m]=(0,o.useState)(null),{createErrorNotice:p,removeNotice:y}=(0,t.useDispatch)("core/notices");return(0,o.useEffect)((()=>{const e=c((async()=>{y("wc-montonio-blik-error","wc/checkout"),s.showModal&&s.showModal();try{return await s.validate()?{type:"success",meta:{paymentMethodData:{montonio_blik_code:document.getElementById("montonio_blik_code")?.value||""}}}:(s?.closeModal?.(),{type:"error",message:(0,n.__)("Please enter a valid 6-digit BLIK code.","montonio-for-woocommerce")})}catch(e){return s?.closeModal?.(),s?.reset?.(),{type:"error",message:e.message||(0,n.__)("An error occurred during payment processing. Please try again.","montonio-for-woocommerce")}}})),o=i((async e=>{try{const{processingResponse:o}=e,t=o.paymentDetails?.payment_intent_uuid;if("success"!==o.paymentStatus||!t)throw new Error((0,n.__)("Payment intent not found in the response.","montonio-for-woocommerce"));{const e=await s.waitForPayment(t);if(e?.merchantReturnUrl)return{type:"success",redirectUrl:e.merchantReturnUrl}}}catch(e){s?.closeModal?.(),s?.reset?.();const o=e.message||(0,n.__)("An error occurred during payment processing. Please try again.","montonio-for-woocommerce");return p(o,{context:"wc/checkout"}),{type:"error",message:o,retry:!0}}})),t=a((e=>{s?.closeModal?.(),s?.reset?.();const{processingResponse:o}=e,t=o.paymentDetails?.message;return{type:"error",message:t,retry:!0,messageContext:"wc/checkout"}}));return()=>{e(),o(),t()}}),[c,i,a,s,p,y]),(0,e.createElement)(e.Fragment,null,d&&(0,e.createElement)("p",{className:"montonio-payment-block-description"},u(d)),(0,e.createElement)(w,{setEmbeddedPayment:m}))},y=()=>(0,e.createElement)("span",null,(0,e.createElement)("img",{src:l.iconurl,alt:"Montonio BLIK"}));r({name:"wc_montonio_blik",label:(0,e.createElement)((()=>(0,e.createElement)("span",null,m,(0,e.createElement)(y,null))),null),content:(0,e.createElement)(p,null),edit:(0,e.createElement)(p,null),canMakePayment:()=>a("wc_montonio_blik_block_enabled",!0,l),ariaLabel:m})})();